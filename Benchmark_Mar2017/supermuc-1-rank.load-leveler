#!/bin/bash
#@ job_type = parallel
#@ class = micro
#@ node = 1
#@ tasks_per_node = 1
#@ island_count = 1
#@ network.MPI = sn_all,not_shared,us 
#@ energy_policy_tag = Z4_energy_tag
#@ minimize_time_to_solution = yes
#@ wall_clock_limit = 04:00:00
#@ job_name = Z4-1-rank
#@ network.MPI = sn_all,not_shared,us
#@ notification=complete
#@ notify_user=tobias.weinzierl@durham.ac.uk
#@ error =  $(job_name).$(jobid).err
#@ queue
. /etc/profile
. /etc/profile.d/modules.sh
module load gcc/4.9
module load tbb

SLURM_ARRAY_TASK_ID=0
SLURM_JOB_NUM_NODES=1
SLURM_NTASKS=1

#
# Important for multithreaded MPI
#
export MP_SINGLE_THREAD=no


mpiexec -n $SLURM_NTASKS ./ExaHyPE-Z4-p3-notbb-mpi   benchmarks/Z4-regular-$SLURM_ARRAY_TASK_ID-p3-no-output.exahype  > $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out
#mpiexec -n $SLURM_NTASKS ./ExaHyPE-Z4-p3-notbb-mpi   benchmarks/Z4-regular-$SLURM_ARRAY_TASK_ID-p3-output.exahype     > $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-output-notbb.out


mpiexec -n $SLURM_NTASKS ./ExaHyPE-Z4-p9-notbb-mpi   benchmarks/Z4-regular-$SLURM_ARRAY_TASK_ID-p9-no-output.exahype  > $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out
#mpiexec -n $SLURM_NTASKS ./ExaHyPE-Z4-p9-notbb-mpi   benchmarks/Z4-regular-$SLURM_ARRAY_TASK_ID-p9-output.exahype     > $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-output-notbb.out



cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out  Z4-28-ranks-per-node-1-nodes-0-p3-no-output-notbb.out
cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out  Z4-28-ranks-per-node-1-nodes-0-p9-no-output-notbb.out

cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out  Z4-14-ranks-per-node-1-nodes-1-p3-no-output-notbb.out
cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out  Z4-14-ranks-per-node-1-nodes-1-p9-no-output-notbb.out

cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out  Z4-7-ranks-per-node-1-nodes-2-p3-no-output-notbb.out
cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out  Z4-7-ranks-per-node-1-nodes-2-p9-no-output-notbb.out

cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out  Z4-4-ranks-per-node-1-nodes-3-p3-no-output-notbb.out
cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out  Z4-4-ranks-per-node-1-nodes-3-p9-no-output-notbb.out

cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p3-no-output-notbb.out  Z4-2-ranks-per-node-1-nodes-4-p3-no-output-notbb.out
cp $LOADL_JOB_NAME-$SLURM_JOB_NUM_NODES-nodes-$SLURM_ARRAY_TASK_ID-p9-no-output-notbb.out  Z4-2-ranks-per-node-1-nodes-4-p9-no-output-notbb.out
